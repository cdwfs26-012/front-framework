<div class="bg-black py-10">
  <div class="max-w-7xl mx-auto px-4">

    @if (loading()) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
        @for (i of [1,2,3,4,5,6,7,8]; track i) {
          <div class="h-[450px] bg-neutral-900/50 animate-pulse rounded-[2.5rem] border border-neutral-800"></div>
        }
      </div>
    } @else {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">

        @for (product of filteredProducts(); track product.reference) {
          <article
            (click)="goToDetail(product.url)"
            class="group bg-neutral-900/30 border border-neutral-800 rounded-[2.5rem] p-4 hover:border-orange-500/50 transition-all duration-500 flex flex-col cursor-pointer">

            <div class="relative aspect-[4/3] mb-5 overflow-hidden rounded-[2rem] bg-black border border-neutral-800">
              <img [src]="product.image"
                   [alt]="product.name"
                   #prodImg
                   (error)="prodImg.src = 'data/produits/placeholder.png'"
                   class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700">
            </div>

            <div class="px-2 flex-grow flex flex-col">
              <h3 class="text-xl font-black text-white leading-tight uppercase tracking-tight mb-1">
                {{ product.name }}
              </h3>

              <span class="text-orange-500 text-[10px] font-bold uppercase tracking-[0.2em] mb-3">
                {{ getCollectionTitle(product.collectionId) }}
              </span>

              <div class="flex items-center gap-2 mb-6">
                <span class="text-neutral-400 text-xs font-medium">
                  {{ product.pieces }} pièces
                </span>
              </div>

              <div class="mt-auto pt-4 border-t border-neutral-800/50 flex items-center justify-between">
                <div class="flex flex-col">
                  <span class="text-[9px] text-neutral-500 uppercase font-bold tracking-widest">Prix</span>
                  <span class="text-white font-black text-xl">
                    {{ product.prixUnitaire | number:'1.2-2' }}€
                  </span>
                </div>

                <button
                  (click)="addToCart($event, product)"
                  class="bg-white text-black h-12 w-12 rounded-2xl hover:bg-orange-500 hover:text-white transition-all duration-300 flex items-center justify-center group/btn shadow-lg shadow-black/40">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4" />
                  </svg>
                </button>
              </div>
            </div>

          </article>
        } @empty {
          <div class="col-span-full py-20 text-center">
            <p class="text-neutral-600 text-xl italic font-light">Aucun produit trouvé dans cette catégorie...</p>
          </div>
        }
      </div>
    }
  </div>
</div>
